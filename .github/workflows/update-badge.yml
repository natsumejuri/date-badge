name: Update Days Since Badge

on:
  schedule:
    - cron: '0 0 * * *'       # 每天凌晨 0 点 UTC 自动运行
  workflow_dispatch:          # 允许手动触发

jobs:
  update-badge:
    runs-on: ubuntu-latest

    steps:
      - name: Checkout code
        uses: actions/checkout@v3

      - name: Calculate days and generate badge
        run: |
          # 起始日期（修改这里即可）
          START_DATE="2024-01-01"
          TODAY=$(date -u +%Y-%m-%d)
          DAYS_SINCE=$(( ( $(date -ud "$TODAY" +%s) - $(date -ud "$START_DATE" +%s) ) / 86400 ))

          mkdir -p output
          BADGE_SVG="<svg xmlns='http://www.w3.org/2000/svg' width='200' height='40'>
          <rect width='100%' height='100%' fill='pink'/>
          <text x='10' y='25' font-size='20' fill='black'>HRT: $DAYS_SINCE days</text>
          </svg>"

          echo "$BADGE_SVG" > output/badge.svg

      - name: Commit and push
        run: |
          git config --global user.name "github-actions[bot]"
          git config --global user.email "github-actions[bot]@users.noreply.github.com"
          git add output/badge.json
          git commit -m "Update badge" || echo "No changes"
          git push
